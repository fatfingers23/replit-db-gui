import{d as C,a as m,o as k,c as S,w as t,f as e,g as f,t as b,b as T,k as U,q as j,H as A,y as F,K as H,N as P,l as O,ak as W,X as Y,b2 as g,an as B,b4 as q,V as E,e as l,b3 as I,bc as K,i as h}from"./index.cf337e7e.js";import{a as X,c as V,d as x,W as z,V as G,e as J}from"./lazy.c1fb1597.js";import{_ as M}from"./json-editor-vue.7333c4d4.js";import{V as y}from"./VDialog.9253433a.js";import{V as Q}from"./VAlert.e502b11f.js";import"./VOverlay.d793e9bc.js";const Z=C({__name:"ReadonlyDBView",props:{database:{type:Object},backup:{type:Object}},setup(n){var v;const u=n,o=m((v=u.backup)==null?void 0:v.data);return(c,d)=>(k(),S(x,{class:"fill-height h-100"},{default:t(()=>[e(X,null,{default:t(()=>{var r,p;return[f(" This is a read only snap shot of your database "+b((r=u.database)==null?void 0:r.slug)+" at "+b(new Date((p=u.backup)==null?void 0:p.created_at).toLocaleString()),1)]}),_:1}),e(V,null,{default:t(()=>[e(T(M),{modelValue:o.value,"onUpdate:modelValue":d[0]||(d[0]=r=>o.value=r),class:"jse-theme-dark"},null,8,["modelValue"])]),_:1})]),_:1}))}});const ee=U({name:"VTable",props:{fixedHeader:Boolean,fixedFooter:Boolean,height:[Number,String],hover:Boolean,...j(),...A(),...F()},setup(n,u){let{slots:o}=u;const{themeClasses:v}=H(n),{densityClasses:c}=P(n);return O(()=>{var d,r;return e(n.tag,{class:["v-table",{"v-table--fixed-height":!!n.height,"v-table--fixed-header":n.fixedHeader,"v-table--fixed-footer":n.fixedFooter,"v-table--has-top":!!o.top,"v-table--has-bottom":!!o.bottom,"v-table--hover":n.hover},v.value,c.value]},{default:()=>[(d=o.top)==null?void 0:d.call(o),o.default&&e("div",{class:"v-table__wrapper",style:{height:W(n.height)}},[e("table",null,[o.default()])]),(r=o.bottom)==null?void 0:r.call(o)]})}),{}}}),te=l("thead",null,[l("tr",null,[l("th",{class:"text-left"}," Backup Time "),l("th",{class:"text-left"}),l("th",{class:"text-left"}),l("th",{class:"text-left"})])],-1),ae={class:"text-left"},le={class:"text-decoration-underline font-weight-bold"},oe={class:"text-decoration-underline font-weight-bold"},ce=C({__name:"BackupsList",setup(n){const u=new z(""),v=q().params.id,c=m([]),d=m(!1),r=m(!1),p=m(),w=m(),D=Y(()=>{var s;return new Date((s=c.value)==null?void 0:s.url_expire_date)>new Date});u.listBackups(v).then(s=>c.value=s);function $(){var s;u.restoreBackup((s=p.value)==null?void 0:s.id).then(i=>{d.value=!1,p.value={}})}function L(s){u.deleteBackup(s),u.listBackups(v).then(i=>c.value=i)}function N(s){u.getBackup(s).then(i=>{w.value=i,r.value=!0})}return(s,i)=>(k(),g(B,null,[e(G,{class:"fill-height"},{default:t(()=>[e(E,{class:"d-flex align-center text-center fill-height"},{default:t(()=>[e(x,{class:"mx-auto",title:`Your backups for ${c.value.slug}`},{default:t(()=>[e(V,null,{default:t(()=>[e(ee,null,{default:t(()=>[te,l("tbody",ae,[(k(!0),g(B,null,I(c.value.user_backups,(a,_)=>(k(),g("tr",{key:_},[l("td",null,b(new Date(a.created_at).toLocaleString()),1),l("td",null,[e(h,{variant:"outlined","prepend-icon":"mdi-database-eye",onClick:R=>N(a==null?void 0:a.id)},{default:t(()=>[f(" view ")]),_:2},1032,["onClick"])]),l("td",null,[e(h,{variant:"outlined",color:"yellow",disabled:!T(D),"prepend-icon":"mdi-backup-restore",onClick:()=>{d.value=!0,p.value=a}},{default:t(()=>[f(" Restore ")]),_:2},1032,["disabled","onClick"])]),l("td",null,[e(h,{variant:"outlined",color:"red","prepend-icon":"mdi-database-eye",onClick:R=>L(a==null?void 0:a.id)},{default:t(()=>[f(" delete ")]),_:2},1032,["onClick"])])]))),128))])]),_:1})]),_:1})]),_:1},8,["title"])]),_:1}),e(y,{modelValue:d.value,"onUpdate:modelValue":i[1]||(i[1]=a=>d.value=a),width:"50%"},{default:t(()=>[e(x,null,{default:t(()=>[e(K,{color:"rgba(0, 0, 0, 0)",theme:"dark"},{append:t(()=>[e(h,{onClick:i[0]||(i[0]=a=>d.value=!1),icon:"mdi-close"})]),_:1}),e(V,null,{default:t(()=>[e(Q,{type:"warning",variant:"outlined"},{default:t(()=>{var a,_;return[f("Are you sure you want to restore the backup taken on "),l("span",le,b(new Date((a=p.value)==null?void 0:a.created_at).toLocaleString()),1),f(" onto the database: "),l("span",oe,b((_=c.value)==null?void 0:_.slug),1),f(". This cannot be undone and will replace all the data in this database with the backup. ")]}),_:1})]),_:1}),e(J,null,{default:t(()=>[e(h,{color:"primary",block:"",onClick:$},{default:t(()=>[f(" Yes i am sure, restore to this backup.")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(y,{modelValue:r.value,"onUpdate:modelValue":i[2]||(i[2]=a=>r.value=a),fullscreen:""},{default:t(()=>[e(Z,{database:c.value,backup:w.value},null,8,["database","backup"])]),_:1},8,["modelValue"])],64))}});export{ce as default};
