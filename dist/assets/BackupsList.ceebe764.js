import{d as C,a as p,o as k,c as S,w as t,e,f,t as b,u as T,j as N,n as U,G as A,x as F,J as P,M as W,k as H,aj as O,W as Y,b1 as V,am as B,b3 as E,V as G,b as l,b2 as I,bc as J,h}from"./index.e2c7bcbb.js";import{a as M,c as g,d as x,W as q,V as z,e as K}from"./lazy.f2ba3b05.js";import{_ as Q}from"./json-editor-vue.e1d562a2.js";import{V as y}from"./VDialog.ecbb3c52.js";import{V as X}from"./VAlert.d97f589c.js";import"./VOverlay.574a7f82.js";const Z=C({__name:"ReadonlyDBView",props:{database:{type:Object},backup:{type:Object}},setup(n){var v;const u=n,o=p((v=u.backup)==null?void 0:v.data);return(c,d)=>(k(),S(x,null,{default:t(()=>[e(M,null,{default:t(()=>{var r,m;return[f(" This is a read only snap shot of your database "+b((r=u.database)==null?void 0:r.slug)+" at "+b(new Date((m=u.backup)==null?void 0:m.created_at).toLocaleString()),1)]}),_:1}),e(g,null,{default:t(()=>[e(T(Q),{modelValue:o.value,"onUpdate:modelValue":d[0]||(d[0]=r=>o.value=r),class:"jse-theme-dark"},null,8,["modelValue"])]),_:1})]),_:1}))}});const ee=N({name:"VTable",props:{fixedHeader:Boolean,fixedFooter:Boolean,height:[Number,String],hover:Boolean,...U(),...A(),...F()},setup(n,u){let{slots:o}=u;const{themeClasses:v}=P(n),{densityClasses:c}=W(n);return H(()=>{var d,r;return e(n.tag,{class:["v-table",{"v-table--fixed-height":!!n.height,"v-table--fixed-header":n.fixedHeader,"v-table--fixed-footer":n.fixedFooter,"v-table--has-top":!!o.top,"v-table--has-bottom":!!o.bottom,"v-table--hover":n.hover},v.value,c.value]},{default:()=>[(d=o.top)==null?void 0:d.call(o),o.default&&e("div",{class:"v-table__wrapper",style:{height:O(n.height)}},[e("table",null,[o.default()])]),(r=o.bottom)==null?void 0:r.call(o)]})}),{}}}),te=l("thead",null,[l("tr",null,[l("th",{class:"text-left"}," Backup Time "),l("th",{class:"text-left"}),l("th",{class:"text-left"}),l("th",{class:"text-left"})])],-1),ae={class:"text-left"},le={class:"text-decoration-underline font-weight-bold"},oe={class:"text-decoration-underline font-weight-bold"},ce=C({__name:"BackupsList",setup(n){const u=new q(""),v=E().params.id,c=p([]),d=p(!1),r=p(!1),m=p(),w=p(),D=Y(()=>{var s;return new Date((s=c.value)==null?void 0:s.url_expire_date)>new Date});u.listBackups(v).then(s=>c.value=s);function $(){var s;u.restoreBackup((s=m.value)==null?void 0:s.id).then(i=>{d.value=!1,m.value={}})}function j(s){u.deleteBackup(s),u.listBackups(v).then(i=>c.value=i)}function L(s){u.getBackup(s).then(i=>{w.value=i,r.value=!0})}return(s,i)=>(k(),V(B,null,[e(z,{class:"fill-height"},{default:t(()=>[e(G,{class:"d-flex align-center text-center fill-height"},{default:t(()=>[e(x,{class:"mx-auto",title:`Your backups for ${c.value.slug}`},{default:t(()=>[e(g,null,{default:t(()=>[e(ee,null,{default:t(()=>[te,l("tbody",ae,[(k(!0),V(B,null,I(c.value.user_backups,(a,_)=>(k(),V("tr",{key:_},[l("td",null,b(new Date(a.created_at).toLocaleString()),1),l("td",null,[e(h,{variant:"outlined","prepend-icon":"mdi-database-eye",onClick:R=>L(a==null?void 0:a.id)},{default:t(()=>[f(" view ")]),_:2},1032,["onClick"])]),l("td",null,[e(h,{variant:"outlined",color:"yellow",disabled:!T(D),"prepend-icon":"mdi-backup-restore",onClick:()=>{d.value=!0,m.value=a}},{default:t(()=>[f(" Restore ")]),_:2},1032,["disabled","onClick"])]),l("td",null,[e(h,{variant:"outlined",color:"red","prepend-icon":"mdi-database-eye",onClick:R=>j(a==null?void 0:a.id)},{default:t(()=>[f(" delete ")]),_:2},1032,["onClick"])])]))),128))])]),_:1})]),_:1})]),_:1},8,["title"])]),_:1}),e(y,{modelValue:d.value,"onUpdate:modelValue":i[1]||(i[1]=a=>d.value=a),width:"50%"},{default:t(()=>[e(x,null,{default:t(()=>[e(J,{color:"rgba(0, 0, 0, 0)",theme:"dark"},{append:t(()=>[e(h,{onClick:i[0]||(i[0]=a=>d.value=!1),icon:"mdi-close"})]),_:1}),e(g,null,{default:t(()=>[e(X,{type:"warning",variant:"outlined"},{default:t(()=>{var a,_;return[f("Are you sure you want to restore the backup taken on "),l("span",le,b(new Date((a=m.value)==null?void 0:a.created_at).toLocaleString()),1),f(" onto the database: "),l("span",oe,b((_=c.value)==null?void 0:_.slug),1),f(". This cannot be undone and will replace all the data in this database with the backup. ")]}),_:1})]),_:1}),e(K,null,{default:t(()=>[e(h,{color:"primary",block:"",onClick:$},{default:t(()=>[f(" Yes i am sure, restore to this backup.")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(y,{modelValue:r.value,"onUpdate:modelValue":i[2]||(i[2]=a=>r.value=a)},{default:t(()=>[e(Z,{database:c.value,backup:w.value},null,8,["database","backup"])]),_:1},8,["modelValue"])],64))}});export{ce as default};
